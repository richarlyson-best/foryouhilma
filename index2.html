<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Sophia ü©∑</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        /* --- CSS GERAL --- */
        :root {
            --bg-color: #0f1111;
            --text-main: #f0f0f0;
            --text-muted: #a0a0a0;
            --accent-pink: #ffc2c2;
            --card-bg: rgba(255, 255, 255, 0.03);
            --font-body: 'Poppins', sans-serif;
            --font-title: 'Playfair Display', serif;
            --spacing-section: 80px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            /* Fundo suave do site principal */
            background-image: radial-gradient(circle at 50% 0%, #1a1515 0%, var(--bg-color) 70%);
        }

        /* --- 1. ESTILOS DA TELA DE CARREGAMENTO (OVERLAY) --- */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f1111; z-index: 10000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px; text-align: center;
        }

        .loading-text {
            font-family: var(--font-title);
            font-size: 1.2rem;
            color: var(--text-main);
            margin-bottom: 40px;
            min-height: 80px;
            max-width: 90%;
            transition: opacity 0.5s ease;
        }

        .highlight-intro { color: var(--accent-pink); font-style: italic; }

        .progress-container {
            width: 80%; max-width: 300px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            display: none; 
        }

        .progress-bar {
            width: 0%; height: 100%;
            background: var(--accent-pink);
            border-radius: 10px;
            box-shadow: 0 0 10px var(--accent-pink);
        }

        .rotate-icon {
            font-size: 3rem; color: var(--accent-pink);
            margin-bottom: 20px; display: none;
            animation: rotatePhone 2s infinite ease-in-out;
        }

        #ios-permission-btn {
            display: none; margin-top: 20px; padding: 12px 24px;
            background: var(--accent-pink); color: #000;
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer;
            font-family: var(--font-body);
        }

        @keyframes rotatePhone {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); } /* Girar pra direita */
            100% { transform: rotate(0deg); }
        }

        /* --- 2. ESTILOS DO SITE PRINCIPAL --- */
        #main-content { display: none; opacity: 0; }

        h1, h2, h3 { font-family: var(--font-title); font-weight: 400; letter-spacing: 0.5px; }
        .highlight { color: var(--accent-pink); font-style: italic; }
        .name-title { font-size: 2.5rem; margin-bottom: 0.5rem; line-height: 1.2; }
        .container { width: 90%; max-width: 600px; margin: 0 auto; padding: 0 15px; }
        section { margin-bottom: var(--spacing-section); position: relative; opacity: 0; }

        /* Spotify */
        .spotify-wrapper { background: var(--card-bg); border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 30px; margin-top: 40px; }
        .visualizer { display: flex; justify-content: center; gap: 3px; margin-top: 10px; height: 15px; align-items: flex-end; }
        .bar { width: 3px; background: var(--accent-pink); border-radius: 3px; animation: sound 0.8s infinite ease-in-out alternate; }
        .bar:nth-child(2) { animation-duration: 0.9s; height: 60%; }
        
        /* Contador */
        .countdown-timer { display: flex; justify-content: center; gap: 20px; margin-top: 15px; }
        .time-unit { display: flex; flex-direction: column; align-items: center; }
        .time-val { font-family: var(--font-title); font-size: 2rem; color: var(--accent-pink); }
        .time-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); }
        .pulse-text { animation: pulseSoft 2s infinite; }

        /* Digita√ß√£o */
        .typing-box { background: linear-gradient(180deg, rgba(255,255,255,0.02) 0%, rgba(255,255,255,0) 100%); padding: 25px; border-left: 2px solid var(--accent-pink); border-radius: 0 10px 10px 0; min-height: 120px; font-size: 1rem; color: #dcdcdc; }
        .cursor { animation: blink 1s infinite; color: var(--accent-pink); }

        /* Fotos */
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .photo-item { position: relative; aspect-ratio: 3/4; border-radius: 8px; overflow: hidden; background: #1a1a1a; }
        /* Skeleton */
        .photo-item::before { content: ""; position: absolute; top:0; left:0; width: 100%; height: 100%; background: linear-gradient(90deg, #1a1a1a 0%, #252525 50%, #1a1a1a 100%); background-size: 200% 100%; animation: shimmer 1.5s infinite linear; z-index: 1; }
        .photo-item.loaded-container::before { display: none; }
        /* Img */
        .photo-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transform: scale(1.05); filter: blur(12px); transition: opacity 0.6s ease, transform 0.6s ease, filter 0.6s ease; position: absolute; top: 0; left: 0; z-index: 2; }
        .photo-item img.loaded { opacity: 1; transform: scale(1); filter: blur(0); }

        /* Decis√£o */
        .decision-section { text-align: center; }
        .video-wrapper { position: relative; width: 100%; margin-bottom: 25px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .video-wrapper video { width: 100%; height: auto; display: block; border-radius: 12px; }
        .buttons-wrapper { display: flex; justify-content: center; gap: 20px; margin-top: 20px; position: relative; height: 60px; }
        .btn { min-width: 140px; max-width: 200px; height: 48px; padding: 0 20px; border: none; border-radius: 50px; font-family: var(--font-body); font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; z-index: 100; }
        .btn-yes { background: var(--accent-pink); color: #000; box-shadow: 0 4px 15px rgba(255, 194, 194, 0.3); }
        .btn-no { background: transparent; border: 1px solid var(--text-muted); color: var(--text-muted); }
        
        #danger-message, #success-message { display: none; margin-top: 20px; padding: 20px; background: var(--card-bg); border-radius: 10px; }
        .verse { font-family: var(--font-title); font-style: italic; color: var(--accent-pink); font-size: 1.1rem; margin-bottom: 10px; display: block; }

        /* Bloqueio Final */
        .locked-section { position: relative; padding-top: 20px; }
        .locked-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 17, 17, 0.6); backdrop-filter: blur(4px); z-index: 5; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border-radius: 8px; }
        .locked-grid img { filter: blur(15px); transition: filter 1.5s ease; }
        .unlocked .locked-grid img { filter: blur(0); }
        .unlocked .locked-overlay { pointer-events: none; opacity: 0; transition: opacity 0.5s; }

        footer { text-align: center; padding: 40px 0 20px; font-size: 0.75rem; color: #444; }

        /* Anima√ß√µes */
        @keyframes pulseSoft { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        @keyframes sound { 0% { height: 20%; } 100% { height: 100%; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes shimmer { 0% {background-position: -200% 0;} 100% {background-position: 200% 0;} }
        @media (max-width: 480px) { .name-title { font-size: 2rem; } .buttons-wrapper { gap: 10px; } }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div id="rotate-icon" class="rotate-icon"><i class="fa-solid fa-mobile-screen-button"></i></div>
        
        <p class="loading-text" id="msg-box"></p>
        
        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <button id="ios-permission-btn">Habilitar Gravidade üîì</button>
    </div>

    <div id="main-content">
        
        <section class="section container">
            <div class="spotify-wrapper">
                <iframe style="border-radius:12px" src="" id="spotify-iframe" width="100%" height="80" frameBorder="0" loading="lazy"></iframe>
                <div class="visualizer">
                    <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                </div>
            </div>
        </section>

        <section class="section container countdown-container" style="text-align: center;">
            <h1 class="name-title pulse-text">Chega, <span class="highlight">Hilma Sophia</span></h1>
            <p style="color: var(--text-muted); margin-bottom: 10px;">Falta pouco pro grande reencontro.</p>
            <div class="countdown-timer" id="timer-display"></div>
        </section>

        <section class="section container">
            <div class="typing-box">
                <span id="typing-target"></span><span class="cursor">|</span>
            </div>
        </section>

        <section class="section container">
            <h2 style="text-align:center; margin-bottom:20px;">Nossos <span class="highlight">Momentos</span></h2>        
            <div class="photo-grid">
                <div class="photo-item"><img class="lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://images.unsplash.com/photo-1516589178581-a7870abd2166?auto=format&fit=crop&q=80&w=600"></div>
                <div class="photo-item"><img class="lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&q=80&w=600"></div>
                <div class="photo-item"><img class="lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://images.unsplash.com/photo-1511988617509-a57c8a288659?auto=format&fit=crop&q=80&w=600"></div>
                <div class="photo-item"><img class="lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://images.unsplash.com/photo-1621600411688-4be93cd68504?auto=format&fit=crop&q=80&w=600"></div>
            </div>
            <p style="text-align:center; font-size: 0.8rem; color: #666; margin-top: 15px;">(Mem√≥rias sendo carregadas...)</p>
        </section>

        <section class="section container decision-section">
            <h2 style="margin-bottom: 20px;">Agora me diz...</h2>
            <div class="video-wrapper">
                <video controls>
                    <source src="videos/pastorrafael.mp4" type="video/mp4">
                    Seu navegador n√£o suporta a tag de v√≠deo.
                </video>
            </div>
            <p style="margin-bottom: 15px;">Aceita o desafio?</p>
            <div class="buttons-wrapper" id="btn-container">
                <button class="btn btn-yes" id="btn-yes">SIM</button>
                <button class="btn btn-no" id="btn-no">N√ÉO</button>
            </div>
            <div id="success-message">
                <span class="verse">"Mulher virtuosa quem a achar√°? O seu valor muito excede ao de rubis." (Prov√©rbios 31:10)</span>
                <p>Eu a encontrei. E ela est√° lendo isso agora. Te amo, Hilma Sophia.</p>
            </div>
            <div id="danger-message"></div>
        </section>

        <section class="section container locked-section" id="final-section">
            <div class="locked-overlay" id="lock-overlay">
                <i class="fa-solid fa-lock" style="font-size:2rem; color:#a0a0a0; margin-bottom:10px;"></i>
                <p style="font-size:0.9rem; color:#ccc;">(bloqueada)<br>Voc√™ entender√° no futuro.</p>
            </div>
            <p style="text-align:center; margin-bottom: 15px;"><span class="highlight">√â, pelo visto deu certo...</span></p>
            <div class="photo-grid locked-grid">
                <div class="photo-item"><img src="https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?auto=format&fit=crop&q=80&w=600"></div>
                <div class="photo-item"><img src="https://images.unsplash.com/photo-1494774157365-9e04c6720e47?auto=format&fit=crop&q=80&w=600"></div>
            </div>
            <p style="text-align:center; font-size: 0.8rem; color: #666; margin-top:15px;">Sonhei tanto com isso, estou t√£o grato.</p>
        </section>

        <footer><p>Criado com todo amor do mundo ¬© 2025</p></footer>
    </div>

    <script>
        /**
         * ===============================================
         * ‚öôÔ∏è CONFIGURA√á√ÉO DO SISTEMA
         * ===============================================
         */
        
        // Mude para TRUE se quiser testar o comportamento de 20/dez hoje
        const DEBUG_MODE = true; 
        const DEBUG_HOUR = 12.5; // Hor√°rio simulado (ex: 9 para culto, 12.5 para transi√ß√£o)

        // CONSTANTES DE DATA E HORA
        const TARGET_DAY = 20;
        const TARGET_MONTH = 11; // Dezembro (0-11)
        const TARGET_YEAR = 2025;

        const MIN_CULTO_START = 7 * 60;      // 07:00
        const MIN_CULTO_END = 12 * 60;       // 12:00
        const MIN_TRANSITION_END = 13 * 60 + 30; // 13:30

        // Configura√ß√µes do Site Rom√¢ntico
        const CONFIG_SITE = {
            spotifyUrl: "https://open.spotify.com/embed/track/2plxK3m1fXn2F5p4jA7Z9m?utm_source=generator",
            targetDateISO: "2025-12-16T00:00:00",
            typingMsg: "Ebaaaaa, voc√™ finalmente chegou ü•∫ \n\nSe est√° vendo isso, significa que nosso reencontro deu certo, n√©? \nEspero que tenha gostado, estou fazendo esse site dia 21 de novembro.\n\n(Estou muito ansioso pela sua chegada. Mas me diz, gostou da caixa? Se eu te disser que queria ter vivido esse momento ano passado, voc√™ acredita? Mas esse ano vai ser diferente, t√° certo?)\n\nPS: Recebi uma √≥tima not√≠cia que voltar√° dia 16, ent√£o volta 4 dias contador haha",
        };

        let IS_UNLOCKED = false; // Vari√°vel para desbloqueio manual

        // DOM Elements (Loading)
        const elOverlay = document.getElementById('loading-overlay');
        const elMsg = document.getElementById('msg-box');
        const elProgressContainer = document.getElementById('progress-container');
        const elProgressBar = document.getElementById('progress-bar');
        const elRotateIcon = document.getElementById('rotate-icon');
        const btnIOS = document.getElementById('ios-permission-btn');
        const elMain = document.getElementById('main-content');

        let orientationGranted = false;

        /**
         * ===============================================
         * üöÄ INICIALIZA√á√ÉO (LOADING SCREEN)
         * ===============================================
         */
        window.onload = function() {
            initSystem();
        };

        function initSystem() {
            const now = new Date();
            const currentDay = now.getDate();
            const currentMonth = now.getMonth();
            // Calcula minutos do dia (Ex: 12:30 = 750)
            const currentMinutes = (DEBUG_MODE ? DEBUG_HOUR * 60 : now.getHours() * 60 + now.getMinutes());

            // Verifica se √© 20/12/2025 (ou Debug)
            const isTargetDate = (currentDay === TARGET_DAY && currentMonth === TARGET_MONTH && now.getFullYear() === TARGET_YEAR) || DEBUG_MODE;

            // Reset di√°rio do contador
            manageLocalStorage(isTargetDate);

            if (!isTargetDate) {
                // Outros dias: Carregamento Simples
                runSequenceLate(); 
                return;
            }

            // 1. CULTO (07:00 - 12:00)
            if (currentMinutes >= MIN_CULTO_START && currentMinutes < MIN_CULTO_END) {
                handleCultoPhase();
            }
            // 2. TRANSI√á√ÉO (12:00 - 13:30)
            else if (currentMinutes >= MIN_CULTO_END && currentMinutes < MIN_TRANSITION_END) {
                handleTransitionPhase();
            }
            // 3. TARDE (> 13:30)
            else {
                runSequenceLate();
            }
        }

        function manageLocalStorage(isTargetDate) {
            const lastDate = localStorage.getItem('lastAccessDate');
            const todayStr = new Date().toDateString();
            if (lastDate !== todayStr) {
                localStorage.setItem('accessCount_culto_20dez', '0');
                localStorage.setItem('lastAccessDate', todayStr);
            }
        }

        /* --- FASE 1: CULTO --- */
        async function handleCultoPhase() {
            let count = parseInt(localStorage.getItem('accessCount_culto_20dez') || '0');
            count++;
            localStorage.setItem('accessCount_culto_20dez', count);

            elProgressContainer.style.display = 'block';

            if (count === 1) {
                await typeText(`Voc√™ √© curiosa n√©?<br>Ansiosa eu j√° sabia, mas pelo visto voc√™ tem o combo kkkkkkk`);
                await wait(3000);
                await typeText(`Vamos prestar aten√ß√£o no culto e se acalme por favor üíõ`);
                await wait(3000);
                await typeText(`Fui buscar √°gua e voc√™ tentando me enrolar, gaiata üòÇ`);
                finishBlocked(); // N√£o libera
            } 
            else if (count === 2) {
                await typeText(`De novo menina? T√° tudo bem?<br>Qualquer coisa estou aqui do seu lado kkkkkkk`);
                finishBlocked(); // N√£o libera
            } 
            else {
                // 3¬∫ acesso: Entra no desafio da f√≠sica
                await typeText(`Opaaa, pera l√°, j√° foi uma, duas e agora 3‚Ä¶`);
                await wait(2500);
                await typeText(`Respira um pouco, t√° bom?`);
                await wait(2000);
                await typeText(`Vou segurar por mais alguns segundinhos‚Ä¶`);
                
                await animateBar(0, 50, 2);
                await animateBar(50, 40, 1);
                await animateBar(40, 85, 3);

                startOrientationChallenge();
            }
        }

        function finishBlocked() {
            gsap.to(elProgressBar, {width: "15%", duration: 1});
        }

        /* --- FASE 2: TRANSI√á√ÉO --- */
        async function handleTransitionPhase() {
            elProgressContainer.style.display = 'block';

            await typeText(`Carregando...`);
            await animateBar(0, 60, 2);
            
            await typeText(`Ops, acho que a barra ficou cansada, v√° beber uma √°gua enquanto isso‚Ä¶`);
            await animateBar(60, 50, 1.5);
            await wait(2000);

            await animateBar(50, 85, 2);
            await typeText(`T√° bom, j√° enchi sua paci√™ncia n√©?`);
            await wait(2000);

            startOrientationChallenge();
        }

        /* --- FASE 3: TARDE / OUTROS DIAS --- */
        async function runSequenceLate() {
            elProgressContainer.style.display = 'block';
            await typeText(`Carregando...`);
            await animateBar(0, 100, 1.5);
            await typeText(`Fiz com carinho viu‚Ä¶<br>Depois me diz o que achou üíõ`);
            await wait(2500);
            unlockSite();
        }

        /* --- L√ìGICA DE ORIENTA√á√ÉO (GAMMA) --- */
        async function startOrientationChallenge() {
            await typeText(`Pra ser mais r√°pido, deixe o celular <span class="highlight-intro">deitado pra direita</span>.`);
            elRotateIcon.style.display = 'block';
            
            // Permiss√£o iOS
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                btnIOS.style.display = 'block';
                btnIOS.onclick = requestIOSPermission;
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
            }

            // Timeout para mensagem de f√≠sica
            setTimeout(() => {
                if (!orientationGranted) {
                    typeText(`Vamos l√°, t√¥ aguardando‚Ä¶<br>Se n√£o, a barra n√£o cai üëÄ<br><span style="font-size:0.8rem">(√â f√≠sica viu‚Ä¶ sua mat√©ria preferida)</span>`);
                }
            }, 6000);
        }

        function requestIOSPermission() {
            DeviceOrientationEvent.requestPermission()
                .then(response => {
                    if (response === 'granted') {
                        btnIOS.style.display = 'none';
                        window.addEventListener('deviceorientation', handleOrientation);
                    } else {
                        alert("Preciso da permiss√£o para funcionar!");
                    }
                })
                .catch(console.error);
        }

        function handleOrientation(event) {
            const gamma = event.gamma; 

            if (!orientationGranted) {
                // Valida√ß√£o Gamma: 30 a 90 (Deitado Direita)
                if (gamma > 30 && gamma < 90) {
                    successRightSide();
                } 
                // Errado (Esquerda)
                else if (gamma < -30) {
                    elMsg.innerHTML = `Ei, virou pro lado errado kkkkk<br>A barra vai subir assim üòÇ<br>Vira pro outro lado‚Ä¶`;
                }
            }
        }

        let isUnlocking = false;
        async function successRightSide() {
            if (isUnlocking) return;
            isUnlocking = true;
            orientationGranted = true;

            window.removeEventListener('deviceorientation', handleOrientation);
            elRotateIcon.style.display = 'none';

            await typeText(`Agora sim! Depois me diz o que achou üíõ`);
            
            gsap.to(elProgressBar, {width: "100%", duration: 0.8, ease: "bounce.out"});
            await wait(1500);
            
            await typeText(`Depois coloque ele na posi√ß√£o normal‚Ä¶`);
            await wait(2000);
            
            unlockSite();
        }

        /* --- UTILS DO LOADING --- */
        function typeText(html) {
            return new Promise(resolve => {
                elMsg.style.opacity = 0;
                setTimeout(() => {
                    elMsg.innerHTML = html;
                    elMsg.style.opacity = 1;
                    setTimeout(resolve, 500);
                }, 500);
            });
        }
        function animateBar(from, to, duration) {
            return new Promise(resolve => {
                gsap.fromTo(elProgressBar, { width: from + "%" }, { width: to + "%", duration: duration, ease: "power1.inOut", onComplete: resolve });
            });
        }
        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

        function unlockSite() {
            gsap.to(elOverlay, {
                opacity: 0, duration: 1,
                onComplete: () => {
                    elOverlay.style.display = 'none';
                    elMain.style.display = 'block';
                    gsap.to(elMain, { opacity: 1, duration: 1 });
                    initMainSite(); // Inicia o site rom√¢ntico
                }
            });
        }


        /**
         * ===============================================
         * 3. L√ìGICA DO SITE ROM√ÇNTICO PRINCIPAL
         * ===============================================
         */
        function initMainSite() {
            gsap.registerPlugin(ScrollTrigger);

            // Spotify
            document.getElementById('spotify-iframe').src = CONFIG_SITE.spotifyUrl;

            // Timer
            setInterval(updateTimer, 1000); updateTimer();

            // Typing
            typeMainText(CONFIG_SITE.typingMsg, 0);

            // Lazy Load
            setupLazyLoad();

            // Anima√ß√µes Scroll
            gsap.utils.toArray('.section').forEach(sec => {
                gsap.to(sec, { opacity: 1, y: 0, duration: 1, scrollTrigger: { trigger: sec, start: "top 85%" } });
            });

            // Check Desbloqueio Final
            if(IS_UNLOCKED) unlockFinal();
        }

        // --- Fun√ß√µes Auxiliares do Site ---
        function updateTimer() {
            const gap = new Date(CONFIG_SITE.targetDateISO).getTime() - new Date().getTime();
            const el = document.getElementById("timer-display");
            if (gap < 0) { el.innerHTML = "<div class='time-val'>Finalmente!</div>"; return; }
            const d = Math.floor(gap / 86400000);
            const h = Math.floor((gap % 86400000) / 3600000);
            const m = Math.floor((gap % 3600000) / 60000);
            el.innerHTML = `<div class="time-unit"><span class="time-val">${d}</span><span class="time-label">Dias</span></div>
                            <div class="time-unit"><span class="time-val">${h}</span><span class="time-label">Horas</span></div>
                            <div class="time-unit"><span class="time-val">${m}</span><span class="time-label">Min</span></div>`;
        }

        function typeMainText(text, i) {
            if (i < text.length) {
                document.getElementById("typing-target").innerHTML = text.substring(0, i+1);
                setTimeout(() => typeMainText(text, i + 1), 40);
            }
        }

        function setupLazyLoad() {
            const obs = new IntersectionObserver((entries, o) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.src = e.target.getAttribute('data-src');
                        e.target.onload = () => { e.target.classList.add('loaded'); e.target.closest('.photo-item').classList.add('loaded-container'); };
                        o.unobserve(e.target);
                    }
                });
            });
            document.querySelectorAll('img.lazy').forEach(img => obs.observe(img));
        }

        // --- L√≥gica do Bot√£o N√ÉO (Fuga) ---
        const btnNo = document.getElementById('btn-no');
        const btnYes = document.getElementById('btn-yes');
        const dangerMsg = document.getElementById('danger-message');
        const successMsg = document.getElementById('success-message');
        let attemptsNo = 0, isMoving = false, isFinalState = false;

        function moveButton(e) {
            if (isFinalState) return;
            if(e) { e.preventDefault(); e.stopPropagation(); }
            if(isMoving) return;
            isMoving = true; setTimeout(() => isMoving = false, 250);
            attemptsNo++;

            if(attemptsNo >= 3) {
                isFinalState = true;
                btnNo.innerText = "T√Å BOM, PODE SER";
                btnNo.onclick = () => btnYes.click();
                
                // Remove listeners
                btnNo.removeEventListener('mouseover', moveButton);
                btnNo.removeEventListener('touchstart', moveButton);
                btnNo.removeEventListener('click', moveButton);
                
                dangerMsg.style.display = 'block';
                dangerMsg.innerHTML = `<span class="verse" style="color: var(--accent-pink);">Voc√™ n√£o √© Pedro, mas pelo visto me negou tr√™s vezes n√©? Acontece, mas precisamos nos ver mais vezes, n√©?</span>`;
                gsap.from(dangerMsg, { scale:0.9, opacity:0, duration:0.5 });
                return;
            }

            // C√°lculo da Fuga
            const rect = btnNo.getBoundingClientRect();
            if (btnNo.style.position !== 'fixed') {
                btnNo.style.position = 'fixed'; btnNo.style.left = rect.left + 'px'; btnNo.style.top = rect.top + 'px';
            }
            const vpW = window.innerWidth, vpH = window.innerHeight;
            const blockedTop = document.getElementById('final-section').getBoundingClientRect().top;
            
            let newL = parseFloat(btnNo.style.left) + ((Math.random() * 240) - 120);
            let newT = parseFloat(btnNo.style.top) + ((Math.random() * 160) - 80);
            // Limites seguros
            newL = Math.max(10, Math.min(newL, vpW - rect.width - 10));
            newT = Math.max(10, Math.min(newT, Math.min(vpH - rect.height - 10, blockedTop - rect.height - 20)));
            
            gsap.to(btnNo, { left: newL, top: newT, duration: 0.3, ease: "power2.out" });
        }
        btnNo.addEventListener('mouseover', moveButton);
        btnNo.addEventListener('touchstart', moveButton, {passive: false});
        btnNo.addEventListener('click', moveButton);

        // --- Bot√£o SIM ---
        btnYes.addEventListener('click', () => {
            gsap.to('.buttons-wrapper', { autoAlpha: 0, height: 0, margin:0, duration: 0.5 });
            gsap.to('.decision-section h2', { autoAlpha: 0, height: 0, margin: 0, duration: 0.5 });
            if(dangerMsg) dangerMsg.style.display = 'none';
            successMsg.style.display = 'block';
            gsap.from(successMsg, { scale: 0.8, opacity: 0, duration: 0.8, ease: "back.out(1.7)" });
        });

        // --- Desbloqueio Final ---
        window.unlockFinal = function() {
            document.getElementById('final-section').classList.add('unlocked');
            gsap.to('#lock-overlay', { opacity: 0, duration: 1, onComplete: () => document.getElementById('lock-overlay').style.display='none' });
        };

    </script>
</body>
</html>